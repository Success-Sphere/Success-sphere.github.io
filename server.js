import express from"express";import session from"express-session";import{db}from"./db.js";const app=express();app.use(express.json());app.use(session({secret:"your-secret",resave:false,saveUninitialized:false}));
// Session check endpoint
app.get("/api/session",(req,res)=>{if(req.session?.userId){db.query("SELECT fullName, email, avatarUrl FROM users WHERE id = ?",[req.session.userId],(err,results)=>{if(err||results.length===0){return res.status(401).json({loggedIn:false})}const user=results[0];res.json({loggedIn:true,user:user})})}else{res.status(401).json({loggedIn:false})}});
// Logout endpoint example
app.post("/api/logout",(req,res)=>{req.session.destroy(err=>{if(err)return res.status(500).json({message:"Logout failed"});res.json({message:"Logged out"})})});app.listen(3e3,()=>console.log("Server running on port 3000"));